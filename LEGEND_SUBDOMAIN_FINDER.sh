#!/bin/bash

cat << 'EOF'

ㅤ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣠⣴⣶⣾⣿⣿⣿⣿⣶⣦⣤⣀⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣾⣿⣿⣿⣿⣿⢿⣿⣿⣿⣽⣿⣿⣿⣿⣷⣤⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣀⣾⣿⣿⣿⣿⣿⣿⢿⡿⣿⣿⣿⣿⣿⣿⣿⣟⣿⡿⣦⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣼⣿⣿⣿⣿⠟⠉⠁⠀⠀⠀⠀⠀⠉⠈⠉⠛⠛⢿⣿⣿⢿⣧⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⢀⣾⣿⣿⣿⣿⠏⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢹⣿⣿⣿⣆⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⢻⣿⣿⣿⣿⡿⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢿⣿⣿⣿⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠸⢻⣿⣿⡟⢁⡴⠶⠶⣶⣶⣤⡀⠀⠀⠀⢀⣤⣤⣄⣀⣀⢸⣿⣿⣿⠇⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⢸⣿⣿⣷⡏⢀⣴⣶⣲⢿⣿⠆⠀⠀⢠⣿⣿⣭⣥⣄⡉⢳⡟⣿⣿⡆⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠸⣿⣿⡿⠃⠈⠛⠀⠀⠀⠀⠀⠀⠀⠀⠈⠁⠉⠉⠹⠗⠙⡇⣿⣿⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⢀⡄⢿⣿⠁⠀⠀⠀⠀⠀⠀⠀⣀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣿⡇⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⡺⡿⣿⣿⡄⠀⠀⠀⠀⠀⠀⢶⣾⠿⠶⠷⣶⠀⠀⠀⠀⠀⠀⢠⣿⣵⣿⡀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⣿⡀⢻⣿⣷⠀⠀⠀⠀⠀⠀⠀⠁⠀⠀⠀⠁⠀⠀⠀⠀⠀⠀⣼⣿⡋⢏⡃⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠈⢿⠿⣿⣟⠀⠀⠀⠀⠀⢀⡴⠖⠚⠛⠓⠶⣤⡀⠀⠀⠀⠀⢸⣿⣦⠟⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠐⠛⣿⠀⠀⠀⠀⠀⠀⠀⠐⢦⣤⣤⡦⠈⠀⠀⠀⠀⠀⣸⠷⠋⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣿⣦⣀⠀⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣰⣨⡏⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢹⣿⣿⣷⣼⣦⡀⠀⠀⠀⠀⠀⠀⠀⣀⣤⣶⣿⣿⡇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢸⣿⣿⣿⣿⣿⣿⣷⣶⣦⣶⣶⣶⣾⣿⣿⣿⣿⢿⡇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢸⣿⠟⠿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡿⠋⠀⡇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢸⡇⠀⠀⠈⢿⡿⠛⠛⠛⠛⠛⠛⠛⠉⠉⠀⠀⠀⣇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢸⡇⠀⠀⠀⠈⣷⡄⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢸⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣾⡇⠀⠀⠀⠀⠈⠻⢷⣤⣀⡴⠚⠀⠀⠀⠀⠀⠀⣾⡄⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⣀⢴⣾⣿⠁⠀⠀⠀⠀⠀⠀⠀⠛⠋⠁⠀⠀⠀⠀⠀⠀⠀⣿⣿⢦⡀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⢀⣠⢞⡅⠈⢿⣿⣦⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣰⡿⠃⠀⣌⠲⢄⡀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⣀⢴⣫⠾⠋⠀⠀⠀⠈⠛⢿⣷⣦⣀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣤⠾⠟⠉⠀⠀⠀⠈⠳⢤⡉⠒⢤⣀⠀⠀
⣀⠤⢖⣮⠷⠛⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠉⠉⠛⠓⠒⠒⠒⠒⠒⠉⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠉⠳⢤⣈⠑⠲
⣷⠶⠋⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠉⠳⡾
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⣀⣀⣀⣀⣀⣀⣀⣀⣀⣀⣀⣀⣀⣀⣀⣀⣀⣀⣀⣀⣀⣀⣀⣀⣀⣀⣀⣀⣀⣀⣀⣀⣀⣀⣀⣀⣀⣀⣀⣀⣀⣀⡄
⢽⣿⣿⠛⢻⣿⣿⣿⣿⠛⠛⠛⠛⢻⣿⣿⠿⠛⠛⠿⣿⡟⠛⠛⠛⠛⣿⡟⢿⣿⣿⣿⠛⢻⡟⠛⠛⠛⠻⣿⣿⣿⡇
⢸⣿⣿⠀⢸⣿⣿⣿⣿⠀⢿⣿⣿⣿⡿⠁⣴⣶⣶⣾⣿⡇⠀⣿⣿⣿⣿⡏⢀⠙⢿⣿⠀⢸⡇⠀⣷⣷⣆⠈⢿⣿⡇
⢸⣿⣿⠀⢸⣿⣿⣿⣿⠀⢤⣤⣴⣿⣧⠀⢿⣿⣤⠀⣿⡇⠀⣤⣤⣼⣿⡇⠀⣷⣄⠙⠀⢸⡇⠀⣿⣿⡟⠀⣸⣿⡇
⢸⣿⣿⣀⣈⣉⣉⣉⣿⣀⣈⣉⣉⣹⣿⣷⣄⣈⣁⣤⣿⣇⣀⣉⣉⣉⣿⣇⣀⣿⣿⣷⣄⣸⣧⣀⣉⣉⣀⣴⣿⣿⡇
EOF

# ╔══════════════════════════════════════════════════════════════╗
# ║   Bash Subdomain Finder – Live + IP + Spinner + Open Links   ║
# ╚══════════════════════════════════════════════════════════════╝

# Colors
GREEN="\e[32m"
YELLOW="\e[33m"
CYAN="\e[36m"
ORANGE="\e[38;5;214m"
RED="\e[31m"
RESET="\e[0m"

# Check dependencies
for tool in curl grep dig; do
    if ! command -v "$tool" >/dev/null; then
        echo -e "${ORANGE}[!] $tool not found. Please install it.${RESET}"
        exit 1
    fi
done

# Detect open command for browser
if command -v xdg-open &>/dev/null; then
    OPEN_CMD="xdg-open"
elif command -v open &>/dev/null; then
    OPEN_CMD="open"
elif command -v start &>/dev/null; then
    OPEN_CMD="start"
else
    echo -e "${RED}[!] No known browser open command found (xdg-open/open/start). Links won't open.${RESET}"
    OPEN_CMD=""
fi

spinner() {
    local pid=$1
    local message=$2
    local delay=0.1
    local frames=(
        "[■         ]"
        "[■■        ]"
        "[■■■       ]"
        "[■■■■      ]"
        "[■■■■■     ]"
        "[■■■■■■    ]"
        "[■■■■■■■   ]"
        "[■■■■■■■■  ]"
        "[■■■■■■■■■ ]"
        "[■■■■■■■■■■]"
        "[■■■■■■■■■ ]"
        "[■■■■■■■■  ]"
        "[■■■■■■■   ]"
        "[■■■■■■    ]"
        "[■■■■■     ]"
        "[■■■■      ]"
        "[■■■       ]"
        "[■■        ]"
        "[■         ]"
    )

    local i=0
    tput civis
    while kill -0 "$pid" 2>/dev/null; do
        printf "\r${ORANGE}[*] $message ${frames[i]}${RESET}"
        i=$(( (i + 1) % ${#frames[@]} ))
        sleep "$delay"
    done
    tput cnorm
    printf "\r${ORANGE}[*] $message... done.             ${RESET}\n"
}

get_domain_and_subs() {
    while true; do
        if [ -z "$1" ]; then
            read -rp $'\e[38;5;214mEnter the domain (e.g. example.com): \e[0m' DOMAIN
        else
            DOMAIN="$1"
            set --
        fi

        if [ -z "$DOMAIN" ]; then
            echo -e "${RED}[!] No domain entered.${RESET} ${RED}GIVE VALID DOMAIN${RESET}"
            continue
        fi

        TMP_SUBS=$(mktemp)

        (
            curl -s "https://crt.sh/?q=%25.${DOMAIN}" |
            grep -oP '(?<=<TD>)[a-zA-Z0-9._-]+\.'"$DOMAIN"'(?=</TD>)' |
            sort -u > "$TMP_SUBS"
        ) &
        spinner $! "Fetching subdomains from crt.sh"

        if [ ! -s "$TMP_SUBS" ]; then
            echo -e "${ORANGE}[!] No subdomains found for ${DOMAIN}.${RESET}"
            echo -e "${RED}GIVE VALID DOMAIN${RESET}"
            rm "$TMP_SUBS"
            continue
        fi

        break
    done
}

get_domain_and_subs "$1"

TMP_LIVE=$(mktemp)

echo -e "${ORANGE}[*] Checking which subdomains are live and resolving IPs...${RESET}"

check_live() {
    local sub=$1
    for proto in https http; do
        if curl -s --head --max-time 4 "$proto://$sub" | grep -qi "HTTP/"; then
            ip=$(dig +short "$sub" | grep -Eo '([0-9]{1,3}\.){3}[0-9]{1,3}' | head -n 1)
            echo "$proto://$sub|$ip" >> "$TMP_LIVE"
            break
        fi
    done
}

export -f check_live
export TMP_LIVE

while read -r sub; do
    [[ -z "$sub" ]] && continue
    check_live "$sub" &
done < "$TMP_SUBS"

wait

if [ ! -s "$TMP_LIVE" ]; then
    echo -e "${ORANGE}[!] No live subdomains found.${RESET}"
    rm "$TMP_SUBS" "$TMP_LIVE"
    exit 1
fi

# Store live entries in array for opening later
mapfile -t LIVE_ENTRIES < <(sort -u "$TMP_LIVE")

echo
echo -e "${GREEN}Live subdomains found:${RESET}"
counter=1

for entry in "${LIVE_ENTRIES[@]}"; do
    IFS="|" read -r live ip <<< "$entry"
    clickable_url="\e]8;;$live\e\\$live\e]8;;\e\\"
    if [[ -n "$ip" ]]; then
        echo -e "${GREEN}[${counter}] Live: ${clickable_url} ${CYAN}[IP: $ip]${RESET}"
    else
        echo -e "${GREEN}[${counter}] Live: ${clickable_url} ${YELLOW}[IP: Not resolved]${RESET}"
    fi
    ((counter++))
done

echo
if [ -z "$OPEN_CMD" ]; then
    echo -e "${RED}[!] No browser open command detected, cannot open links.${RESET}"
else
    while true; do
        read -rp $'\e[38;5;214mEnter number to open link in browser (q to quit): \e[0m' choice
        if [[ "$choice" =~ ^[Qq]$ ]]; then
            echo "Exiting."
            break
        elif [[ "$choice" =~ ^[0-9]+$ ]] && (( choice >= 1 && choice <= ${#LIVE_ENTRIES[@]} )); then
            url=$(echo "${LIVE_ENTRIES[choice-1]}" | cut -d'|' -f1)
            echo -e "${ORANGE}Opening ${url} in your default browser...${RESET}"
            $OPEN_CMD "$url" >/dev/null 2>&1 &
        else
            echo -e "${RED}Invalid choice. Please enter a valid number or 'q' to quit.${RESET}"
        fi
    done
fi

# Cleanup
rm "$TMP_SUBS" "$TMP_LIVE"
